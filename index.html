<!DOCTYPE html>
<html>
<head>
    <base href="https://itsr6y.github.io/Bill.AI/">

    <meta charset="UTF-8">
    <meta content="IE=Edge" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>BILL.AI</title>
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/png" href="favicon.png"/>

    <style>
        html, body {
            margin: 0;
            height: 100%;
            background-color: black;
            overflow: hidden;
        }

        #html-splash {
            position: fixed;
            inset: 0;
            background: black;
            z-index: 99999;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column; 
            cursor: pointer; 
            /* This transition is for the smooth fade-out effect */
            transition: opacity 0.5s ease; 
        }

        #splash-video {
            position: absolute;
            width: 100%;
            height: 100%;
            z-index: 1; 
            
            /* --- üì± MOBILE DEFAULT (Screens under 768px) --- */
            /* Scales to fit the whole video frame, constrained by the width, 
               with black bars on top/bottom if necessary. */
            object-fit: contain; 
        }

        /* --- üñ•Ô∏è DESKTOP/TABLET (Screens 768px and wider) --- */
        @media (min-width: 768px) {
            #splash-video {
                /* Fills the entire screen, cropping video if necessary (cover) */
                object-fit: cover; 
            }
        }
        
        #tap-overlay {
            z-index: 5; 
            color: #FDE047; 
            font-family: 'CyberFont', sans-serif; 
            font-size: 24px;
            text-shadow: 0 0 5px #FDE047;
            opacity: 0;
            pointer-events: none; 
            transition: opacity 0.5s ease;
            user-select: none;
            text-align: center;
            line-height: 1.5;
        }

        #tap-overlay.visible {
            opacity: 1;
            pointer-events: auto;
        }

        #loading-text {
            z-index: 5;
            color: white;
            font-family: sans-serif;
            font-size: 16px;
            position: absolute;
            bottom: 50px;
            opacity: 1;
            transition: opacity 0.5s ease;
        }

    </style>

    <script>
        let flutterIsReady = false;
        let hasTapped = false;
        
        // Function to signal the Dart/Flutter application to proceed.
        function callDartTap() {
             if (window.globalTapDetected) {
                // Signals Flutter to start playing its video and unmute it.
                window.globalTapDetected();
            }
        }
        
        // Called by Dart when Flutter is fully loaded and ready. (Condition 1/2 Met)
        function flutterReady() {
            flutterIsReady = true;

            const overlay = document.getElementById("tap-overlay");
            const loadingText = document.getElementById("loading-text");
            
            // 1. Hide loading text
            loadingText.style.opacity = '0';

            // 2. Show "Tap to Continue" overlay
            overlay.classList.add('visible');
        }

        // Function that runs when the user taps the screen after Flutter is ready. (Condition 2/2 Met)
        function handleUserTap() {
            // Check if both conditions are true (Flutter Ready AND hasn't tapped yet)
            if (!flutterIsReady || hasTapped) return;

            hasTapped = true;

            const video = document.getElementById("splash-video");
            const splash = document.getElementById("html-splash");

            // 1. Stop the loop. The video will play through its current iteration and stop.
            video.loop = false;
            
            // 2. SET UP THE DELAY: Wait for the video to finish playing.
            video.addEventListener("ended", () => {
                // üí• VIDEO HAS FINISHED üí•
                
                // 3. Start the visual fade-out now (transition begins).
                splash.style.opacity = '0';

                // 4. Wait for the fade-out duration (0.5s) to complete the transition.
                setTimeout(() => {
                    // Sequence A: Signal Dart.
                    callDartTap();
                    
                    // Sequence B: Remove the element.
                    splash.remove(); 
                }, 500); // 500ms matches the CSS transition: opacity 0.5s ease;
                
            }, { once: true });
        }


        window.addEventListener("load", () => {
            const video = document.getElementById("splash-video");
            const splash = document.getElementById("html-splash");

            // Start looping while Flutter loads
            video.loop = true;
            video.play().catch(e => {
                console.warn("Autoplay failed:", e);
            });
            
            // Attach the click handler to the entire splash screen
            splash.addEventListener("click", handleUserTap, { once: true });
            
        });
    </script>

</head>

<body>
    <div id="html-splash">
        <video id="splash-video" autoplay muted playsinline loop>
            <source src="loading.mp4" type="video/mp4">
        </video>
        
        <div id="loading-text">Loading BILL.AI...</div>
        
        <div id="tap-overlay">
        </div>
    </div>

    <script src="flutter_bootstrap.js" async></script>
</body>

</html>
